---
title: "Lietuvos statistika"
author: "Justas Mundeikis"
date: 2015-07-23T21:13:14-05:00
categories: ["Lietuva"]
tags: ["Lietuva", "statisika"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, collapse = TRUE, error = TRUE, warning = FALSE, message = FALSE)
```

```{r, include=FALSE}
source("./scripts/loading_R_packets.R")
source("./scripts/data_import_GS.R")
source("./scripts/data_import_LT.R")
```

```{r, include=FALSE}
data_world <- read.csv("./data/data_world.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date),
         var=factor(var, levels=c("confirmed", "recovered","deaths")))

data_lt <- read.csv("./data/data_lt.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date_confirmation=as.Date(date_confirmation),
         date_infection=as.Date(date_infection))

# loading shape files
#source: 
gis_data <- st_read(dsn = "./shape_files/bandomasis surasymas.gdb/a0000000a.gdbtable")%>%
  select(SAV_KODAS, SAV_PAV,Is_viso,Shape)%>% 
  group_by(SAV_PAV)%>%
  summarise(gyventojai=sum(Is_viso))%>%
  mutate(SAV_PAV=gsub(" sav.", "", SAV_PAV))
```

# Statistika

Statistika

* iš JHCSSE iki imtinai `r max(data_world$date)`
* iš NVSC iki imtinai `r max(data_lt$date_confirmation)`

## Bendras skaičius

```{r, echo=FALSE}
df <- data_world %>%
  filter(CNTR_CODE == "LT")

max.date <- max(df$date)


ggplot(df, aes(x=date, y=value, fill=var))+
  geom_area(alpha=0.5)+
  scale_fill_manual(values=c("red", "green","black"),
                    labels=c("Aktyvūs", "Pasveikę", "Mirę"))+
  scale_x_date(breaks="1 month", date_labels = "%Y-%m")+
  scale_y_continuous()+
  labs(title="Atvejų skaičius ir pasiskirstymas",
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x = element_text(angle = 45, hjust = 1))
```

## Užsikrėtimų skaičius per paskutines 30d

```{r}
max.date <- max(data_lt$date_confirmation)
two_weeks <- max.date-30

df <- data_lt%>%
  filter(date_confirmation>=two_weeks)%>%
  group_by(date_confirmation)%>%
  count(date_confirmation)%>%
  rename(value=n)

ggplot(df,aes(x=date_confirmation, y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  scale_x_date(breaks = "2 days")+
      scale_y_continuous(limits = c(0,max(df$value)*1.05))+
  labs(title="Užsikrėtimų skaičius per paskutines 30 dienų",
       subtitle="Šaltinis: NVSC, skaičiavimai: Corona-Stat.lt",
       x="Data", 
       y="Užsikrėtimų skaičius")+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))


```

## Užsikrėtimų skaičius per paskutines 7d / pop
Šiame žemėlapyje matomas santykinis užsikrėtimų skaičius (tenkantis 100 000 gyventojų). Duomenys pateikiami savivavlybių lygiu. 

```{r}
max.date <- max(data_lt$date_confirmation)
two_weeks <- max.date-7

test <- data_lt%>%
  filter(date_confirmation>=two_weeks)%>%
  group_by(county)%>%
  summarise(cases=n())%>%
  rename(SAV_PAV=county)

df <- left_join(gis_data, test, by="SAV_PAV")%>%
  mutate(percent=round(cases/gyventojai*100000,0))

my_breaks <- c(1,10,25,100,700,1000)

ggplot(df, aes(fill=percent))+
  geom_sf()+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100")+
  labs(title="Atvejų skaičius tenkantis 100 000 gyventojų per paskutines 7 dienas",
       subtitle = "Šaltinis: NVSC, skaičiavimai: Corona-Stat.lt")

```

## Vakar dienos atvejų skaičius

Šis žemėlapis parodo šiuo metu aktyviausius COVID19 židinius. Skaičiai yra absoliutūs, ne santykiniai.

```{r}
max.date <- max(data_lt$date_confirmation)

test <- data_lt%>%
  filter(date_confirmation>=max.date)%>%
  group_by(county)%>%
  summarise(cases=n())%>%
  rename(SAV_PAV=county)

df <- left_join(gis_data, test, by="SAV_PAV")

my_breaks <- c(1,10,25,100,700,1000)

ggplot(df, aes(fill=cases))+
  geom_sf()+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100")+
  labs(title="Per vakar patvirtintų atvėjų skačius",
       subtitle = "Šaltinis: NVSC, skaičiavimai: Corona-Stat.lt")

```


## Užsikrėtimai pagal amžių
Ši diagrama parodo, kaip pasiskirsto užsikrėtimai pagal amžių ir lyti. Diagramoje naudojami visi turimi duomenys.

```{r}
df <- data_lt%>%
  group_by(age_group, sex)%>%
  summarise(value=n())%>%
  na.omit()%>%
  mutate(age_group=factor(age_group,
                          levels=c("0-9","10-19","20-29","30-39","40-49",
                                   "50-59","60-69","70-79","80-89","90-99","100-109")))

ggplot(df, aes(age_group,value, fill=sex))+
  geom_bar(stat="identity",
           position="dodge")+
  scale_fill_brewer(palette="Set1")+
  labs(title="Užsikrėtimai pagal amžiaus kategorijas",
       subtitle="Šaltinis: NVSC, skaičiavimai: Corona-Stat.lt",
       x="Amžiaus grupė", 
       y="Užsikrėtimų skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x=element_text(angle=45, hjust=1))
```

## Užsikrėtimai pagal amžių per paskutines 7d.

```{r}
max.date <- max(data_lt$date_confirmation)
two_weeks <- max.date-7

df <- data_lt%>%
  filter(date_confirmation>=two_weeks)%>%
  group_by(age_group, sex)%>%
  summarise(value=n())%>%
  na.omit()%>%
  mutate(age_group=factor(age_group,
                          levels=c("0-9","10-19","20-29","30-39","40-49",
                                   "50-59","60-69","70-79","80-89","90-99","100-109")))

ggplot(df, aes(age_group,value, fill=sex))+
  geom_bar(stat="identity",
           position="dodge")+
  scale_fill_brewer(palette="Set1")+
  labs(title="Užsikrėtimai pagal amžiaus kategorijas, paskutinės 7d.",
       subtitle="Šaltinis: NVSC, skaičiavimai: Corona-Stat.lt",
       x="Amžiaus grupė", 
       y="Užsikrėtimų skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x=element_text(angle=45, hjust=1))
```

## Mirtys pagal amžių ir lytį

```{r}
df <- data_lt%>%
  filter(result=="Mirė")%>%
  group_by(age_group, sex)%>%
  summarise(value=n())%>%
  na.omit()%>%
  mutate(age_group=factor(age_group,
                          levels=c("0-9","10-19","20-29","30-39","40-49",
                                   "50-59","60-69","70-79","80-89","90-99","100-109")))

ggplot(df, aes(age_group,value, fill=sex))+
  geom_bar(stat="identity",
           position="dodge")+
  scale_fill_brewer(palette="Set1")+
  labs(title="Mirusieji pagal amžiaus kategorijas",
       subtitle="Šaltinis: NVSC, skaičiavimai: Corona-Stat.lt",
       x="Amžiaus grupė", 
       y="Mirusiųjų skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x=element_text(angle=45, hjust=1))
```

## Mirtys pagal amžių ir chronines ligas

```{r}
df <- data_lt%>%
  filter(result=="Mirė")%>%
  group_by(age_group, has_chronic)%>%
  summarise(value=n())%>%
  na.omit()%>%
  mutate(age_group=factor(age_group,
                          levels=c("0-9","10-19","20-29","30-39","40-49",
                                   "50-59","60-69","70-79","80-89","90-99","100-109")))

ggplot(df, aes(age_group,value))+
  geom_bar(stat="identity",
           position="dodge",
           fill="steelblue")+
  scale_fill_brewer(palette="Set1")+
  labs(title="Mirusieji pagal amžiaus kategorijas, ar turėjo chroninių ligų",
       subtitle="Šaltinis: NVSC, skaičiavimai: Corona-Stat.lt",
       x="Amžiaus grupė", 
       y="Mirusiųjų skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x=element_text(angle=45, hjust=1))+
  facet_wrap(~has_chronic)
```